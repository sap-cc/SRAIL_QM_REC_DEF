{"version":3,"sources":["../../src/controller/Base.controller.ts"],"names":["BaseController","Controller","onInit","oOwnerComponent","getOwnerComponent","oRouter","getRouter","oODataModel","getModel","oDraftController","getDraftController","getStartupParameters","aFieldsToExtract","oComponentData","getComponentData","oStartupParameters","startupParameters","reduce","oParameterMap","sKey","name","type","sParameterValue","Array","isArray","convertParameter","isLaunchpad","sap","ushell","navigateBack","Container","getServiceAsync","then","service","toExternal","target","shellHash","error","console","window","history","go","navigateToCreateDefect","oPredefinedValues","bReplace","navTo","navigateToDefectRecord","sPath","defectRecordPath","substring","parseError","oError","responseText","undefined","response","JSON","parse","message","value","parsedText","replace","trim","translate","i18nKey","args","ignoreKeyFallback","getResourceBundle","getText","sParameter"],"mappings":"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","sourcesContent":["import ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport Controller from \"sap/ui/core/mvc/Controller\";\nimport Router from \"sap/ui/core/routing/Router\";\nimport DraftController from \"sap/ui/generic/app/transaction/DraftController\";\nimport ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\nimport Component, { ComponentData } from \"zqm/nc/recdefectfast/Component\";\nimport { ErrorResponse, RequestError, SapErrorResponse } from \"zqm/nc/recdefectfast/types/error\";\nimport type CrossApplicationNavigation from \"sap/ushell/services/CrossApplicationNavigation\";\n\n/**\n * @namespace zqm.nc.recdefectfast.controller\n */\nexport default class BaseController extends Controller {\n\n    protected oOwnerComponent: Component;\n    protected oRouter: Router;\n    protected oODataModel: ODataModel;\n    protected oDraftController: DraftController;\n\n\n    onInit() {\n        this.oOwnerComponent = this.getOwnerComponent() as Component;\n        this.oRouter = this.oOwnerComponent.getRouter();\n        this.oODataModel = this.oOwnerComponent.getModel() as ODataModel;\n        this.oDraftController = this.oOwnerComponent.getDraftController();\n    }\n\n    protected getStartupParameters(aFieldsToExtract: Array<{ name: string, type?: string }>): Record<string, string | boolean> {\n        const oComponentData: ComponentData = this.getOwnerComponent().getComponentData() != null ? this.getOwnerComponent().getComponentData() : {};\n        const oStartupParameters = oComponentData.startupParameters;\n\n        return aFieldsToExtract\n            .reduce<Record<string, string | boolean>>((oParameterMap, { name: sKey, type }) => {\n                if (oStartupParameters[sKey] != null) {\n                    const sParameterValue = Array.isArray(oStartupParameters[sKey]) ? oStartupParameters[sKey][0] : oStartupParameters[sKey] as string;\n                    oParameterMap[sKey] = this.convertParameter(sParameterValue, type);\n                }\n                return oParameterMap;\n            }, {});\n    }\n\n    protected isLaunchpad(): boolean {\n        return sap.ushell != null;\n    }\n\n    protected navigateBack() {\n        if (this.isLaunchpad()) {\n            sap.ushell.Container.getServiceAsync(\n                \"CrossApplicationNavigation\"\n            ).then(function (service: CrossApplicationNavigation) {\n                service.toExternal({\n                    target: {\n                        shellHash: \"#\",\n                    },\n                });\n            }).catch((error) => {\n                console.error(error);\n                window.history.go(-1);\n            });\n        } else {\n            window.history.go(-1);\n        }\n    }\n\n    protected navigateToCreateDefect(oPredefinedValues: Record<string, string | number | boolean>, bReplace = true) {\n        this.oRouter.navTo(\n            \"main\",\n            {\n                \"?query\": oPredefinedValues\n            },\n            {},\n            bReplace\n        );\n    }\n\n    protected navigateToDefectRecord(sPath: string, bReplace = true) {\n        this.oRouter.navTo(\n            \"record\",\n            {\n                defectRecordPath: sPath.substring(1)\n            },\n            {},\n            bReplace\n        );\n    }\n\n    protected parseError(oError?: ErrorResponse | RequestError | Error | null | unknown) {\n        if (oError != null && typeof oError === \"object\") {\n            let responseText: string | undefined = undefined;\n            if (\"response\" in oError && (oError as ErrorResponse).response.responseText != null) {\n                responseText = (oError as ErrorResponse).response.responseText;\n            } else if ((oError as RequestError).responseText != null) {\n                responseText = (oError as RequestError).responseText;\n            }\n\n            if (responseText != null) {\n                // try to parse JSON\n                try {\n                    const response = JSON.parse(responseText) as SapErrorResponse;\n                    if (response.error && response.error.message && response.error.message.value) {\n                        return response.error.message.value;\n                    }\n\n                } catch {\n                    // might be XML, though => regexp parsing of message value\n                    const parsedText = responseText.replace(/.*<message>(.*)<\\/message>.*/, \"$1\").trim();\n\n                    // otherwise, just show the response text\n                    return parsedText || responseText;\n                }\n            } else if ((oError as Error).message != null) {\n                return (oError as Error).message;\n            }\n        }\n\n        // todo i18n\n        return \"Unknown Error\";\n    }\n\n    /**\n     * Returns a locale-specific string value for the given key sKey.\n     *\n     * The text is searched in this resource bundle according to the fallback chain described in module:sap/base/i18n/ResourceBundle.\n     * If no text could be found, the key itself is used as text.\n     *\n     * If the second parameter args is given, then any placeholder of the form \"{n}\" (with n being an integer) is replaced by the\n     * corresponding value from aArgs with index n.\n     * Note: This replacement is applied to the key if no text could be found.\n     * For more details on the replacement mechanism refer to module:sap/base/strings/formatMessage.\n     *\n     * @param i18nKey the key as specified in properties file\n     * @param args List of parameter values which should replace the placeholders \"{n}\" (n is the index) in the found locale-specific string value.\n     * Note that the replacement is done whenever aArgs is given, no matter whether the text contains placeholders or not and no matter whether\n     * args contains a value for n or not.\n     * @param ignoreKeyFallback If set, undefined is returned instead of the key string, when the key is not found in any bundle or fallback bundle\n     */\n    public translate(i18nKey: string, args?: string[] | number[]): string\n    public translate(i18nKey: string, args?: string[] | number[], ignoreKeyFallback?: true): string | undefined\n    public translate(i18nKey: string, args?: string[] | number[], ignoreKeyFallback?: boolean): string | undefined {\n        return this.getResourceBundle().getText(i18nKey, args, ignoreKeyFallback);\n    }\n\n    protected convertParameter(sParameter: string, type: string): string | boolean {\n        switch (type) {\n            case \"boolean\":\n            case \"Edm.Boolean\":\n                return typeof sParameter === \"boolean\" ? sParameter : sParameter === \"true\";\n            default: {\n                return sParameter;\n            }\n        }\n    }\n\n    private getResourceBundle(): ResourceBundle {\n        return (this.oOwnerComponent.getModel(\"i18n\") as ResourceModel).getResourceBundle() as ResourceBundle;\n    }\n}\n"],"file":"Base.controller.js"}