"use strict";sap.ui.define(["sap/ui/model/json/JSONModel","zqm/nc/recdefectfast/controller/Base.controller"],function(e,t){function r(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function n(){}function o(e,t){if(!t){return e&&e.then?e.then(n):Promise.resolve()}}function a(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}function i(e,t){try{var r=e()}catch(e){return t(e)}if(r&&r.then){return r.then(void 0,t)}return r}function u(e,t){return e&&e.then?e.then(t):t(e)}function c(e){if(e&&e.then){return e.then(n)}}function f(e){return function(){for(var t=[],r=0;r<arguments.length;r++){t[r]=arguments[r]}try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){d(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var h=r(t);var g=h.extend("zqm.nc.recdefectfast.controller.MainController",{onInit:function t(){h.prototype.onInit.call(this);this.oViewModel=new e({defectCategory:null,loading:true,error:null});this.getView().setModel(this.oViewModel);this.oRouter.getRoute("main").attachPatternMatched(this.onRouteMatched,this)},onExit:function e(){this.oRouter.getRoute("main").detachPatternMatched(this.onRouteMatched,this)},onRouteMatched:function e(t){try{var r=false;var n=this;var l=t.getParameter("arguments");n.oViewModel.setData({defectCategory:null,loading:true,error:null});n.oViewModel.refresh();return a(u(i(function(){return a(n.oODataModel.metadataLoaded(true),function(){return o(n.oODataModel.getMetaModel().loaded())})},function(e){var t=n.parseError(e);n.oViewModel.setData({loading:false,error:t},true);r=true}),function(e){var t;if(r)return e;var o=n.oODataModel.getMetaModel().getODataEntityType("QM_DEFECT_RECORD_SRV.C_DefectRecordType");var u=o.property.map(function(e){return{name:e.name,type:e.type}});var d=n.getRouteParameters((t=l["?query"])!==null&&t!==void 0?t:{},u);var h=n.getStartupParameters(u);var g=s(s({ZZ1_NC_LAYOUT_VARIANT_NIT:"STANDARD"},h),d);if(!g.DefectCategory){n.oViewModel.setData({loading:false,error:"Defect category is missing"},true);return}n.oODataModel.read("/I_DefectCategory('".concat(g.DefectCategory,"')"),{success:f(function(){return c(i(function(){return a(n.oDraftController.createNewDraftEntity("C_DefectRecord","/C_DefectRecord",g),function(e){var t=e,r=t.context;n.navigateToDefectRecord(r.getPath(),true)})},function(e){var t=n.parseError(e);n.oViewModel.setData({loading:false,error:t},true)}))}),error:function e(t){var r=n.parseError(t);n.oViewModel.setData({loading:false,error:r},true)}})}))}catch(e){return Promise.reject(e)}},getRouteParameters:function e(t,r){var n=this;return r.reduce(function(e,r){var o=r.name,a=r.type;if(t[o]!=null){e[o]=n.convertParameter(t[o],a)}return e},{})}});return g});