{"version":3,"sources":["../../../src/custom/control/ODataInput.ts"],"names":["value","then","direct","Promise","resolve","getEntitySetNameByBindingContextPath","getODataPropertyForEntitySet","isODataModel","isODataPropertyBinding","ODataInput","attachModelContextChange","handleBinding","detachModelContextChange","binding","getBinding","context","getContext","model","getModel","metadataLoaded","metaModel","getMetaModel","loaded","property","getPath","bindingContextPath","entitySet","oODataProperty","type","required","getProperty","oType","ModelString","parseKeepsEmptyString","minLength","nullable","maxLength","Number","undefined","setType","scale","ModelDecimal","precision","internalType","console","warn","Input"],"mappings":"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","sourcesContent":["import Input from \"sap/m/Input\";\nimport ModelString from \"sap/ui/model/type/String\";\nimport ModelDecimal from \"sap/ui/model/odata/type/Decimal\";\n\nimport {\n    getEntitySetNameByBindingContextPath,\n    getODataPropertyForEntitySet,\n    isODataModel,\n    isODataPropertyBinding\n} from \"zqm/nc/recdefectfast/util/ODataHelper\";\n\n\n/**\n * @namespace zqm.nc.recdefectfast.custom.control\n *\n * Improved version of input that sap.m.Input that sets constraints for the property from odata metadata automatically\n */\nexport default class ODataInput extends Input {\n\n    metadata: {\n        properties: {\n            required: { type: \"boolean\" }\n        },\n    }\n\n    init() {\n        super.init();\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        this.attachModelContextChange(this.handleBinding, this);\n    }\n\n    exit() {\n        super.exit();\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        this.detachModelContextChange(this.handleBinding, this);\n    }\n\n    onBeforeRendering() {\n        super.onBeforeRendering();\n    }\n\n    private async handleBinding() {\n        const binding = this.getBinding(\"value\");\n        if (binding == null) {\n            return;\n        }\n\n        const context = binding.getContext();\n        const model = binding.getModel();\n\n        if (context == null || !isODataPropertyBinding(binding) || !isODataModel(model)) {\n            return;\n        }\n\n        // wait until model & metadata loaded\n        await model.metadataLoaded();\n        const metaModel = model.getMetaModel();\n        await metaModel.loaded();\n\n        // determine oData property definition\n        const property = binding.getPath();\n        const bindingContextPath = context.getPath();\n        const entitySet = getEntitySetNameByBindingContextPath(bindingContextPath);\n\n        const oODataProperty = getODataPropertyForEntitySet(metaModel, entitySet, property);\n        if (oODataProperty == null) {\n            return;\n        }\n\n\n        // update value binding with type from odata metadata\n        if (oODataProperty.type === \"Edm.String\") {\n            const required = !!this.getProperty(\"required\");\n\n            const oType = new ModelString({\n                parseKeepsEmptyString: false,\n            }, {\n                minLength: required || oODataProperty.nullable === \"false\" ? 1 : 0,\n                maxLength: oODataProperty.maxLength != null ? Number(oODataProperty.maxLength) : undefined,\n            });\n\n            binding.setType(oType, \"string\");\n        } else if (oODataProperty.type === \"Edm.Decimal\") {\n            const required = !!this.getProperty(\"required\");\n            const scale: number | undefined = oODataProperty.scale != null ? Number(oODataProperty.scale) : undefined;\n\n            const oType = new ModelDecimal({}, {\n                nullable: !required || oODataProperty.nullable == null ? true : oODataProperty.nullable === \"true\",\n                precision: oODataProperty.precision != null ? Number(oODataProperty.precision) : undefined,\n                scale: scale,\n            });\n\n            const internalType = scale == null || scale === 0 ? \"int\" : \"float\";\n            binding.setType(oType, internalType);\n        } else {\n            console.warn(`Error: Unsupported type '${oODataProperty.type}' for property ${property}`)\n        }\n\n    }\n\n}"],"file":"ODataInput.js"}