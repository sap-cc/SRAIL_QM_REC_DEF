"use strict";sap.ui.define(["sap/ui/core/Core","sap/m/library","sap/ui/comp/smartfield/SmartField","sap/ui/core/library","sap/ui/model/ValidateException","zqm/nc/recdefectfast/util/types","sap/m/RadioButtonGroup","sap/m/CheckBox"],function(e,t,r,n,a,i,u,o){function l(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}function s(){}function f(e,t){if(!t){return e&&e.then?e.then(s):Promise.resolve()}}function d(e,t){try{var r=e()}catch(e){return t(e)}if(r&&r.then){return r.then(void 0,t)}return r}function c(e,t){return e&&e.then?e.then(t):t(e)}function v(e,t){var r=e();if(r&&r.then){return r.then(t)}return t(r)}function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function y(e,t,r){if(t)m(e.prototype,t);if(r)m(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var g=t["getScrollDelegate"];var h=n["ValueState"];var V=i["isInstanceOf"];var B=function(){function t(e){p(this,t);this.view=e}y(t,[{key:"validateFieldGroup",value:function e(t){try{var r=this;var n=r.getFields(t);return l(Promise.all(n.map(function(e){return r.validateField(e)})),function(e){return e.some(Boolean)})}catch(e){return Promise.reject(e)}}},{key:"focusFirstError",value:function e(t){var r=this.getFields(t);var n=r.find(function(e){return e.getValueState()===h.Error});if(n){n.focus();var a=g(n,false);if(a){a.scrollToElement(n.getDomRef())}}}},{key:"getFields",value:function e(t){var r=this;return this.view.getControlsByFieldGroupId(t).filter(function(e){return e.isA(["sap.m.Input","sap.m.TextArea","sap.m.ComboBox","sap.m.RadioButtonGroup","sap.m.CheckBox","sap.ui.comp.smartfield.SmartField"])&&!r.surroundedByParent(e,"sap.ui.comp.smartfield.SmartField")})}},{key:"surroundedByParent",value:function e(t,r){return t==null?false:t.getParent()!=null&&t.getParent().isA("sap.ui.comp.smartfield.SmartField")||this.surroundedByParent(t.getParent(),r)}},{key:"validateField",value:function e(t){try{var n=false;var i=this;if(V(t,u)){return l(i.validateFieldRadioButton(t))}if(V(t,o)){return l(i.validateFieldCheckbox(t))}var s=t.getBinding("value");if(s==null){return l(false)}var p=s.getType();var m=s.getPath();var y=s.getValue();var g=t.getValue();return l(v(function(){if(V(t,r)){return c(d(function(){return f(t.checkValuesValidity())},function(e){if(e instanceof TypeError){console.error(e)}else{n=true;return true}}),function(e){if(n)return e;var r=t.getMandatory()||i.valueAsBoolean(t.data("mandatory"))||i.valueAsBoolean(t.data("required"));var u=y===""||y==null||t.getDataType()==="Edm.Decimal"&&Number(y)===0;if(r&&u){var o=i.getResourceBundleText("SMARTFIELD_INVALID_ENTRY");var l=new a(o);i.fireValidationError(t,m,undefined,g,y,l,o);n=true;return true}i.fireValidationSuccess(t,m,undefined,g,y);n=true;return false})}else return function(){if(p!=null){var e=p.parseValue(g,"string");return c(d(function(){return f(p.validateValue(e))},function(r){i.fireValidationError(t,m,p,e,g,r,r.message);n=true;return true}),function(e){if(n)return e;i.fireValidationSuccess(t,m,p,g,y);n=true;return false})}}()},function(e){return n?e:false}))}catch(e){return Promise.reject(e)}}},{key:"validateFieldRadioButton",value:function e(t){var r=this.valueAsBoolean(t.data("mandatory"));var n=t.data("name");if(!r||!n){return false}var a=t.getBindingContext();if(a==null){return false}var i=a.getProperty(n);if(!i){this.fireValidationError(t,n,undefined,i,i,undefined,undefined);return true}this.fireValidationSuccess(t,n,undefined,i,i);return false}},{key:"validateFieldCheckbox",value:function e(t){var r=this.valueAsBoolean(t.data("mandatory"));var n=t.data("validationname");if(!r||!n){return false}var i=t.getBinding("selected");if(i==null){return false}var u=i.getContext();if(u==null){return false}var o=i.getPath();var l=t.getSelected();var s=this.view.getControlsByFieldGroupId(n).filter(function(e){return e.isA(["sap.m.CheckBox"])});var f=s.some(function(e){return e.getSelected()});if(!f){var d=this.getResourceBundleText("SMARTFIELD_INVALID_ENTRY");var c=new a(d);this.fireValidationError(t,o,undefined,l,l,c,d);return true}this.fireValidationSuccess(t,o,undefined,l,l);return false}},{key:"valueAsBoolean",value:function e(t){return t===true||t==="true"}},{key:"fireValidationError",value:function e(t,r,n,a,i,u,o){t.fireValidationError({element:t,property:r,type:n,newValue:a,oldValue:i,exception:u,message:o});t.setValueState(h.Error);if("setValueStateText"in t){t.setValueStateText(o)}}},{key:"fireValidationSuccess",value:function e(t,r,n,a,i){t.fireValidationSuccess({element:t,property:r,type:n,newValue:a,oldValue:i});t.setValueState(undefined);if("setValueStateText"in t){t.setValueStateText(undefined)}}},{key:"getResourceBundleText",value:function t(r,n){var a=e.getLibraryResourceBundle("sap.ui.comp");return a.getText(r,n)}}]);return t}();return B});